apiVersion: v1
data:
  bminer-card-reward.conf: |-
    {
      "athena_region": "us-west-2",
      "athena_database": "dwh",
      "athena_query": "with coin_info AS (SELECT name,avg(reward_per_unit_hashrate) AS reward_per_unit_hashrate,avg(price) AS price FROM dwh.fact_algorithm_reward WHERE date_diff('hour', from_unixtime(timestamp), current_timestamp) <= 2 GROUP BY  name) SELECT card,coin,price,speed*reward_per_unit_hashrate AS reward,speed*reward_per_unit_hashrate*price AS reward_in_USD FROM dwh.lookup_bminer_speed JOIN coin_info ON lookup_bminer_speed.coin=coin_info.name",
      "clickhouse_uri": "tcp://clickhouse-miner-stats.data:9000?username=bminer&password=2WHvybnS5vHsrMJ2&database=miner_stats",
      "clickhouse_query": "INSERT INTO bminer_card_reward (time, card, coin, price, reward, reward_in_usd) VALUES (?, ?, ?, ?, ?, ?)",
      "append_timestamp": true
    }
kind: ConfigMap
metadata:
  creationTimestamp: "2020-09-20T02:57:51Z"
  name: athena-to-clickhouse-bminer-card-reward-config
  namespace: data
  resourceVersion: "106893126"
  selfLink: /api/v1/namespaces/data/configmaps/athena-to-clickhouse-bminer-card-reward-config
  uid: e3e506b2-5cd7-48c8-9c53-189626bbf45b
