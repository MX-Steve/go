apiVersion: v1
data:
  site-estimation-reward.config: |-
    database_uri = "tcp://clickhouse-miner-stats.data:9000?username=bminer&password=2WHvybnS5vHsrMJ2&database=miner_stats"
    column_number = 4
    insert_statement = "INSERT INTO site_estimation_reward(time, site_key, coin, estimation_reward) values (?,?,?,?)"
    query_statement = '''
      SELECT  o.record_time as time,
              o.site_key as site_key,
              bminer_algorithm_info.coin as coin,
              o.hashrate * bminer_algorithm_info.hashrate_factor * algorithm_reward.reward_per_unit_hashrate as estimated_daily_reward
      FROM (
          SELECT  site_key,
                  algorithm,
                  toStartOfHour(time) as record_time,
                  sum(hashrate15m)/60000 AS hashrate
          FROM miner_card_algorithm_hashrate_new
              WHERE record_time = subtractHours(date_trunc('hour', now()),3)
                  AND time<subtractHours(date_trunc('hour', now()),2)
          GROUP BY site_key, algorithm, record_time
      ) AS o
      JOIN bminer_algorithm_info ON o.algorithm=bminer_algorithm_info.id
      JOIN algorithm_reward ON bminer_algorithm_info.coin=algorithm_reward.name and record_time=algorithm_reward.time
    '''
kind: ConfigMap
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"v1","data":{"site-estimation-reward.config":"database_uri = \"tcp://clickhouse-miner-stats.data:9000?username=bminer\u0026password=2WHvybnS5vHsrMJ2\u0026database=miner_stats\"\ncolumn_number = 4\ninsert_statement = \"INSERT INTO site_estimation_reward(time, site_key, coin, estimation_reward) values (?,?,?,?)\"\nquery_statement = '''\n  SELECT  o.record_time as time,\n          o.site_key as site_key,\n          bminer_algorithm_info.coin as coin,\n          o.hashrate * bminer_algorithm_info.hashrate_factor * algorithm_reward.reward_per_unit_hashrate as estimated_daily_reward\n  FROM (\n      SELECT  site_key,\n              algorithm,\n              toStartOfHour(time) as record_time,\n              sum(hashrate15m)/60000 AS hashrate\n      FROM miner_card_algorithm_hashrate_new\n          WHERE record_time = subtractHours(date_trunc('hour', now()),3)\n              AND time\u003csubtractHours(date_trunc('hour', now()),2)\n      GROUP BY site_key, algorithm, record_time\n  ) AS o\n  JOIN bminer_algorithm_info ON o.algorithm=bminer_algorithm_info.id\n  JOIN algorithm_reward ON bminer_algorithm_info.coin=algorithm_reward.name and record_time=algorithm_reward.time\n'''"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"site-estimation-reward","namespace":"data"}}
  creationTimestamp: "2021-03-08T15:04:49Z"
  managedFields:
  - apiVersion: v1
    fieldsType: FieldsV1
    fieldsV1:
      f:data:
        .: {}
        f:site-estimation-reward.config: {}
      f:metadata:
        f:annotations:
          .: {}
          f:kubectl.kubernetes.io/last-applied-configuration: {}
    manager: kubectl
    operation: Update
    time: "2021-03-08T15:04:49Z"
  name: site-estimation-reward
  namespace: data
  resourceVersion: "170974225"
  selfLink: /api/v1/namespaces/data/configmaps/site-estimation-reward
  uid: 46ce2c98-b8d5-49e7-af6d-a58ed4072177
