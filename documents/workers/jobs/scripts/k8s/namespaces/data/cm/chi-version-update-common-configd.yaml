apiVersion: v1
data:
  01-clickhouse-listen.xml: |
    <yandex>
        <!-- Listen wildcard address to allow accepting connections from other containers and host network. -->
        <listen_host>::</listen_host>
        <listen_host>0.0.0.0</listen_host>
        <listen_try>1</listen_try>
    </yandex>
  02-clickhouse-logger.xml: |
    <yandex>
        <logger>
            <!-- Possible levels: https://github.com/pocoproject/poco/blob/develop/Foundation/include/Poco/Logger.h#L105 -->
            <level>debug</level>
            <log>/var/log/clickhouse-server/clickhouse-server.log</log>
            <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
            <size>1000M</size>
            <count>10</count>
            <!-- Default behavior is autodetection (log to console if not daemon mode and is tty) -->
            <console>1</console>
        </logger>
    </yandex>
  03-clickhouse-querylog.xml: |
    <yandex>
    <query_log replace="1">
        <database>system</database>
        <table>query_log</table>
        <engine>Engine = MergeTree PARTITION BY event_date ORDER BY event_time TTL event_date + interval 30 day</engine>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <collect_interval_milliseconds>1000</collect_interval_milliseconds>
    </query_log>
    <query_thread_log remove="1"/>
    </yandex>
  04-clickhouse-partlog.xml: |
    <yandex>
    <part_log replace="1">
        <database>system</database>
        <table>part_log</table>
        <engine>Engine = MergeTree PARTITION BY event_date ORDER BY event_time TTL event_date + interval 30 day</engine>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <collect_interval_milliseconds>1000</collect_interval_milliseconds>
    </part_log>
    </yandex>
  05-clickhouse-metriclog.xml: |
    <yandex>
    <metric_log replace="1">
        <database>system</database>
        <table>metric_log</table>
        <engine>Engine = MergeTree PARTITION BY event_date ORDER BY event_time TTL event_date + interval 30 day SETTINGS min_bytes_for_wide_part = 10000000</engine>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <collect_interval_milliseconds>1000</collect_interval_milliseconds>
    </metric_log>
    </yandex>
  06-clickhouse-asynchronousmetriclog.xml: |
    <yandex>
    <asynchronous_metric_log replace="1">
        <database>system</database>
        <table>asynchronous_metric_log</table>
        <engine>Engine = MergeTree PARTITION BY event_date ORDER BY event_time TTL event_date + interval 30 day SETTINGS min_bytes_for_wide_part = 10000000</engine>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <collect_interval_milliseconds>1000</collect_interval_milliseconds>
    </asynchronous_metric_log>
    </yandex>
  chop-generated-remote_servers.xml: |
    <yandex>
        <remote_servers>
            <!-- User-specified clusters -->
            <update>
                <shard>
                    <internal_replication>true</internal_replication>
                    <replica>
                        <host>chi-version-update-update-0-0</host>
                        <port>9000</port>
                    </replica>
                    <replica>
                        <host>chi-version-update-update-0-1</host>
                        <port>9000</port>
                    </replica>
                    <replica>
                        <host>chi-version-update-update-0-2</host>
                        <port>9000</port>
                    </replica>
                </shard>
            </update>
            <!-- Autogenerated clusters -->
            <all-replicated>
                <shard>
                    <internal_replication>true</internal_replication>
                    <replica>
                        <host>chi-version-update-update-0-0</host>
                        <port>9000</port>
                    </replica>
                    <replica>
                        <host>chi-version-update-update-0-1</host>
                        <port>9000</port>
                    </replica>
                    <replica>
                        <host>chi-version-update-update-0-2</host>
                        <port>9000</port>
                    </replica>
                </shard>
            </all-replicated>
            <all-sharded>
                <shard>
                    <internal_replication>false</internal_replication>
                    <replica>
                        <host>chi-version-update-update-0-0</host>
                        <port>9000</port>
                    </replica>
                </shard>
                <shard>
                    <internal_replication>false</internal_replication>
                    <replica>
                        <host>chi-version-update-update-0-1</host>
                        <port>9000</port>
                    </replica>
                </shard>
                <shard>
                    <internal_replication>false</internal_replication>
                    <replica>
                        <host>chi-version-update-update-0-2</host>
                        <port>9000</port>
                    </replica>
                </shard>
            </all-sharded>
        </remote_servers>
    </yandex>
kind: ConfigMap
metadata:
  creationTimestamp: "2021-04-02T12:52:19Z"
  labels:
    clickhouse.altinity.com/ConfigMap: ChiCommon
    clickhouse.altinity.com/app: chop
    clickhouse.altinity.com/chi: version-update
    clickhouse.altinity.com/chop: 0.10.0
    clickhouse.altinity.com/namespace: data
  managedFields:
  - apiVersion: v1
    fieldsType: FieldsV1
    fieldsV1:
      f:data:
        .: {}
        f:01-clickhouse-listen.xml: {}
        f:02-clickhouse-logger.xml: {}
        f:03-clickhouse-querylog.xml: {}
        f:04-clickhouse-partlog.xml: {}
        f:05-clickhouse-metriclog.xml: {}
        f:06-clickhouse-asynchronousmetriclog.xml: {}
        f:chop-generated-remote_servers.xml: {}
      f:metadata:
        f:labels:
          .: {}
          f:clickhouse.altinity.com/ConfigMap: {}
          f:clickhouse.altinity.com/app: {}
          f:clickhouse.altinity.com/chi: {}
          f:clickhouse.altinity.com/chop: {}
          f:clickhouse.altinity.com/namespace: {}
    manager: clickhouse-operator
    operation: Update
    time: "2021-04-02T12:52:19Z"
  name: chi-version-update-common-configd
  namespace: data
  resourceVersion: "181054634"
  selfLink: /api/v1/namespaces/data/configmaps/chi-version-update-common-configd
  uid: 2179e716-5f18-4f52-b12c-d936b0ebdd5a
