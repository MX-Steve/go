apiVersion: v1
data:
  bminer-card-max-reward.conf: |-
    {
      "athena_region": "us-west-2",
      "athena_database": "dwh",
      "athena_query": "with coin_info AS (SELECT name,avg(reward_per_unit_hashrate) AS reward_per_unit_hashrate,avg(price) AS price FROM dwh.fact_algorithm_reward WHERE date_diff('hour', from_unixtime(timestamp), current_timestamp) <= 2 GROUP BY  name), card_reward AS (SELECT card,coin,price,speed*reward_per_unit_hashrate AS reward,speed*reward_per_unit_hashrate*price AS reward_in_usd FROM dwh.lookup_bminer_speed JOIN coin_info ON lookup_bminer_speed.coin=coin_info.name ORDER BY  card),max_reward_card AS (SELECT card,max(reward_in_usd) AS max_reward FROM card_reward GROUP BY  card ) SELECT card_reward.card,coin,price,reward,reward_in_usd FROM card_reward JOIN max_reward_card ON card_reward.card=max_reward_card.card AND card_reward.reward_in_usd=max_reward_card.max_reward",
      "clickhouse_uri": "tcp://clickhouse-miner-stats.data:9000?username=bminer&password=2WHvybnS5vHsrMJ2&database=miner_stats",
      "clickhouse_query": "INSERT INTO bminer_card_max_reward (time, card, coin, price, reward, reward_in_usd) VALUES (?, ?, ?, ?, ?, ?)",
      "append_timestamp": true
    }
kind: ConfigMap
metadata:
  creationTimestamp: "2020-09-20T10:20:32Z"
  name: athena-to-clickhouse-bminer-card-max-reward-config
  namespace: data
  resourceVersion: "106893338"
  selfLink: /api/v1/namespaces/data/configmaps/athena-to-clickhouse-bminer-card-max-reward-config
  uid: 131ccce6-2d10-401c-89b4-aa308077e800
