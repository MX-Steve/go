{"remainingRequest":"/data/vssh/frontend/node_modules/babel-loader/lib/index.js!/data/vssh/frontend/node_modules/vue-loader-v16/dist/templateLoader.js??ref--6!/data/vssh/frontend/node_modules/cache-loader/dist/cjs.js??ref--1-0!/data/vssh/frontend/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/data/vssh/frontend/src/components/HelloWorld.vue?vue&type=template&id=469af010","dependencies":[{"path":"/data/vssh/frontend/src/components/HelloWorld.vue","mtime":1643075423607},{"path":"/data/vssh/frontend/babel.config.js","mtime":1642990612224},{"path":"/data/vssh/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1642990596778},{"path":"/data/vssh/frontend/node_modules/babel-loader/lib/index.js","mtime":1642990597524},{"path":"/data/vssh/frontend/node_modules/vue-loader-v16/dist/templateLoader.js","mtime":1642990596737},{"path":"/data/vssh/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1642990596778},{"path":"/data/vssh/frontend/node_modules/vue-loader-v16/dist/index.js","mtime":1642990595732}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgcmVzb2x2ZUNvbXBvbmVudCBhcyBfcmVzb2x2ZUNvbXBvbmVudCwgY3JlYXRlVk5vZGUgYXMgX2NyZWF0ZVZOb2RlLCB3aXRoQ3R4IGFzIF93aXRoQ3R4LCBjcmVhdGVUZXh0Vk5vZGUgYXMgX2NyZWF0ZVRleHRWTm9kZSwgb3BlbkJsb2NrIGFzIF9vcGVuQmxvY2ssIGNyZWF0ZUVsZW1lbnRCbG9jayBhcyBfY3JlYXRlRWxlbWVudEJsb2NrLCBjcmVhdGVDb21tZW50Vk5vZGUgYXMgX2NyZWF0ZUNvbW1lbnRWTm9kZSB9IGZyb20gInZ1ZSI7CnZhciBfaG9pc3RlZF8xID0gewogIGtleTogMAp9OwoKdmFyIF9ob2lzdGVkXzIgPSAvKiNfX1BVUkVfXyovX2NyZWF0ZVRleHRWTm9kZSgiIOi/nuaOpSAiKTsKCnZhciBfaG9pc3RlZF8zID0gLyojX19QVVJFX18qL19jcmVhdGVUZXh0Vk5vZGUoIiDlj5bmtoggIik7Cgp2YXIgX2hvaXN0ZWRfNCA9IHsKICBrZXk6IDEsCiAgY2xhc3M6ICJjb25zb2xlIiwKICBpZDogInRlcm1pbmFsIgp9OwpleHBvcnQgZnVuY3Rpb24gcmVuZGVyKF9jdHgsIF9jYWNoZSwgJHByb3BzLCAkc2V0dXAsICRkYXRhLCAkb3B0aW9ucykgewogIHZhciBfY29tcG9uZW50X2VsX2lucHV0ID0gX3Jlc29sdmVDb21wb25lbnQoImVsLWlucHV0Iik7CgogIHZhciBfY29tcG9uZW50X2VsX2Zvcm1faXRlbSA9IF9yZXNvbHZlQ29tcG9uZW50KCJlbC1mb3JtLWl0ZW0iKTsKCiAgdmFyIF9jb21wb25lbnRfZWxfYnV0dG9uID0gX3Jlc29sdmVDb21wb25lbnQoImVsLWJ1dHRvbiIpOwoKICB2YXIgX2NvbXBvbmVudF9lbF9mb3JtID0gX3Jlc29sdmVDb21wb25lbnQoImVsLWZvcm0iKTsKCiAgcmV0dXJuIF9vcGVuQmxvY2soKSwgX2NyZWF0ZUVsZW1lbnRCbG9jaygiZGl2IiwgbnVsbCwgWyRkYXRhLmlkID09ICcnID8gKF9vcGVuQmxvY2soKSwgX2NyZWF0ZUVsZW1lbnRCbG9jaygiZGl2IiwgX2hvaXN0ZWRfMSwgW19jcmVhdGVWTm9kZShfY29tcG9uZW50X2VsX2Zvcm0sIHsKICAgIHJlZjogImZvcm0iLAogICAgbW9kZWw6ICRkYXRhLmZvcm0sCiAgICAibGFiZWwtd2lkdGgiOiAiMTIwcHgiCiAgfSwgewogICAgZGVmYXVsdDogX3dpdGhDdHgoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gW19jcmVhdGVWTm9kZShfY29tcG9uZW50X2VsX2Zvcm1faXRlbSwgewogICAgICAgIGxhYmVsOiAiaXDlnLDlnYAiCiAgICAgIH0sIHsKICAgICAgICBkZWZhdWx0OiBfd2l0aEN0eChmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gW19jcmVhdGVWTm9kZShfY29tcG9uZW50X2VsX2lucHV0LCB7CiAgICAgICAgICAgIG1vZGVsVmFsdWU6ICRkYXRhLmZvcm0uaXBfYWRkcmVzcywKICAgICAgICAgICAgIm9uVXBkYXRlOm1vZGVsVmFsdWUiOiBfY2FjaGVbMF0gfHwgKF9jYWNoZVswXSA9IGZ1bmN0aW9uICgkZXZlbnQpIHsKICAgICAgICAgICAgICByZXR1cm4gJGRhdGEuZm9ybS5pcF9hZGRyZXNzID0gJGV2ZW50OwogICAgICAgICAgICB9KQogICAgICAgICAgfSwgbnVsbCwgOAogICAgICAgICAgLyogUFJPUFMgKi8KICAgICAgICAgICwgWyJtb2RlbFZhbHVlIl0pXTsKICAgICAgICB9KSwKICAgICAgICBfOiAxCiAgICAgICAgLyogU1RBQkxFICovCgogICAgICB9KSwgX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfZWxfZm9ybV9pdGVtLCBudWxsLCB7CiAgICAgICAgZGVmYXVsdDogX3dpdGhDdHgoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIFtfY3JlYXRlVk5vZGUoX2NvbXBvbmVudF9lbF9idXR0b24sIHsKICAgICAgICAgICAgdHlwZTogInByaW1hcnkiCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGRlZmF1bHQ6IF93aXRoQ3R4KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gW19ob2lzdGVkXzJdOwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgXzogMQogICAgICAgICAgICAvKiBTVEFCTEUgKi8KCiAgICAgICAgICB9KSwgX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfZWxfYnV0dG9uLCBudWxsLCB7CiAgICAgICAgICAgIGRlZmF1bHQ6IF93aXRoQ3R4KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gW19ob2lzdGVkXzNdOwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgXzogMQogICAgICAgICAgICAvKiBTVEFCTEUgKi8KCiAgICAgICAgICB9KV07CiAgICAgICAgfSksCiAgICAgICAgXzogMQogICAgICAgIC8qIFNUQUJMRSAqLwoKICAgICAgfSldOwogICAgfSksCiAgICBfOiAxCiAgICAvKiBTVEFCTEUgKi8KCiAgfSwgOAogIC8qIFBST1BTICovCiAgLCBbIm1vZGVsIl0pXSkpIDogKF9vcGVuQmxvY2soKSwgX2NyZWF0ZUVsZW1lbnRCbG9jaygiZGl2IiwgX2hvaXN0ZWRfNCkpXSk7Cn0="},{"version":3,"sources":["/data/vssh/frontend/src/components/HelloWorld.vue"],"names":[],"mappings":";;;;;+CAQoC,M;;+CACf,M;;;;AAIL,EAAA,KAAK,EAAC,S;AAAU,EAAA,EAAE,EAAC;;;;;;;;;;;uBAZjC,mBAAA,CAaM,KAbN,EAaM,IAbN,EAaM,CAZO,KAAA,CAAA,EAAA,IAAE,E,kBAAb,mBAAA,CAUM,KAVN,EAUM,UAVN,EAUM,CATJ,YAAA,CAQU,kBARV,EAQU;AARD,IAAA,GAAG,EAAC,MAQH;AARW,IAAA,KAAK,EAAE,KAAA,CAAA,IAQlB;AARwB,mBAAY;AAQpC,GARV,E;sBACE;AAAA,aAEe,CAFf,YAAA,CAEe,uBAFf,EAEe;AAFD,QAAA,KAAK,EAAC;AAEL,OAFf,EAA0B;0BACxB;AAAA,iBAAsC,CAAtC,YAAA,CAAsC,mBAAtC,EAAsC;wBAAnB,KAAA,CAAA,IAAA,CAAK,UAAc;;qBAAnB,KAAA,CAAA,IAAA,CAAK,U,GAAU,M;;AAAI,WAAtC,E,IAAA,E;;AAAA,Y,cAAA,CAAsC,CAAtC;AAAA,S,CADwB;;;;AAAA,OAA1B,CAEe,EACf,YAAA,CAGe,uBAHf,EAGe,IAHf,EAGe;0BAFb;AAAA,iBAA0C,CAA1C,YAAA,CAA0C,oBAA1C,EAA0C;AAA/B,YAAA,IAAI,EAAC;AAA0B,WAA1C,EAAyB;8BAAC;AAAA,qBAAI,C,UAAA,CAAJ;AAAA,a,CAAD;;;;AAAA,WAAzB,CAA0C,EAC1C,YAAA,CAA2B,oBAA3B,EAA2B,IAA3B,EAA2B;8BAAhB;AAAA,qBAAI,C,UAAA,CAAJ;AAAA,a,CAAgB;;;;AAAA,WAA3B,CAD0C,CAA1C;AAAA,S,CAEa;;;;AAAA,OAHf,CADe,CAFf;AAAA,K;;;;GADF,E;;AAAA,I,SAAA,CASI,CAVN,C,mBAWA,mBAAA,CAAgD,KAAhD,EAAA,UAAA,C,CACI,CAbN,C","sourcesContent":["<template>\n  <div>\n    <div v-if=\"id == ''\">\n      <el-form ref=\"form\" :model=\"form\" label-width=\"120px\">\n        <el-form-item label=\"ip地址\">\n          <el-input v-model=\"form.ip_address\" />\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\"> 连接 </el-button>\n          <el-button> 取消 </el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n    <div v-else class=\"console\" id=\"terminal\"></div>\n  </div>\n</template>\n<script>\nimport { Terminal } from \"xterm\";\nimport * as attach from \"xterm/lib/addons/attach/attach\";\nimport * as fit from \"xterm/lib/addons/fit/fit\";\nexport default {\n  name: \"webssh\",\n  data() {\n    return {\n      term: null,\n      terminalSocket: null,\n      order: \"\",\n      id: \"\",\n      form: {\n        ip_address: \"\",\n        username: \"\",\n        port: \"\",\n        password: \"\",\n      },\n    };\n  },\n  methods: {},\n  mounted() {\n    let id = location.href.split(\"=\")[1];\n    if (id == undefined) {\n      console.log(\"?id=xxx 必须携带 id 参数\");\n    } else {\n      this.id = id;\n      //实例化一个websocket，用于和django江湖\n      this.terminalSocket = new WebSocket(`ws://127.0.0.1:8000/web/${id}/`);\n      //获取到后端传回的信息\n      this.terminalSocket.onmessage = (res) => {\n        console.log(res);\n        const reader = new window.FileReader();\n        reader.onload = () => this.term.write(reader.result);\n        reader.readAsText(res.data, \"utf-8\");\n        //重置要发送的信息\n        this.order = \"\";\n      };\n      let terminalContainer = document.getElementById(\"terminal\");\n      const width = window.innerWidth;\n      //创建xterm实例\n      this.term = new Terminal({\n        rendererType: \"canvas\",\n        convertEol: true,\n        scrollback: 100,\n        fontSize: 14,\n        disableStdin: false,\n        cursorStyle: \"block\",\n        cursorBlink: true, // 显示光标\n        tabStopWidth: 4,\n        rows: parseInt(width / 17, 10),\n      });\n\n      this.term.open(terminalContainer);\n\n      //在xterm上显示命令行提示\n      this.term.write(\"$ \");\n      //监听xterm的键盘事件\n      this.term.on(\"key\", (key, ev) => {\n        // key是输入的字符 ev是键盘按键事件\n        this.term.write(key);\n        if (ev.keyCode == 13) {\n          //使用webscoket将数据发送到django\n          const data = this.order;\n          this.terminalSocket.send(JSON.stringify({ data }));\n          // this.order=''\n          console.log(\"里面的order\", this.order);\n        } else if (ev.keyCode == 8) {\n          //删除按钮\n          //截取字符串[0,lenth-1]\n          this.order = this.order.substr(0, this.order.length - 1);\n\n          //清空当前一条的命令\n          this.term.write(\"\\x1b[2K\\r\");\n          //简化当前的新的命令显示上\n          this.term.write(\"$ \" + this.order);\n\n          console.log(\"截取的字符串\" + this.order);\n          typeof this.order;\n        } else {\n          // 将每次输入的字符拼凑起来\n          this.order += key;\n          console.log(\"外面的order\", this.order);\n        }\n      });\n    }\n  },\n};\n</script>"],"sourceRoot":""}]}